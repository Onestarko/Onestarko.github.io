{"meta":{"title":"onestarko","subtitle":"","description":"","author":"kowhoy","url":"http://yoursite.com","root":"/"},"pages":[{"title":"categories","date":"2020-02-15T00:58:48.000Z","updated":"2020-02-15T00:59:32.763Z","comments":false,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2020-02-15T00:59:39.000Z","updated":"2020-02-15T01:57:12.301Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"HIVEå®‰è£…é…ç½®","slug":"HIVEå®‰è£…é…ç½®","date":"2020-05-07T02:10:43.000Z","updated":"2020-05-07T02:10:43.794Z","comments":true,"path":"2020/05/07/HIVEå®‰è£…é…ç½®/","link":"","permalink":"http://yoursite.com/2020/05/07/HIVE%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/","excerpt":"","text":"HIVEå®‰è£…é…ç½®ä¸€ã€å‰ç½®ç¯å¢ƒ JAVA HADOOP MYSQL äºŒã€å®‰è£… ä¸‹è½½è§£å‹ 123wget https://mirrors.huaweicloud.com/apache/hive/hive-2.3.6/apache-hive-2.3.6-bin.tar.gztar -zxvf apache-hive-2.3.6-bin.tar.gz -C ../ é…ç½®ç¯å¢ƒå˜é‡ vim ~/.bash_profile 12HIVE_HOME&#x3D;&#x2F;home&#x2F;kowhoy&#x2F;software&#x2F;apache-hive-2.3.6-binexport PATH&#x3D;$HIVE_HOME&#x2F;bin:$PATH ä¸‰ã€é…ç½® æ‹·è´é…ç½®æ–‡ä»¶ 1234567cd $&#123;HIVE_HOME&#125;/confcp hive-env.sh.template hive-env.shcp hive-exec-log4j2.properties.template hive-exec-log4j2.propertiescp hive-log4j2.properties.template hive-log4j2.propertiescp hive-default.xml.template hive-site.xmlcp beeline-log4j2.properties.template beeline-log4j2.properties vim hive-env.sh 12export JAVA_HOME&#x3D;&#x2F;home&#x2F;kowhoy&#x2F;software&#x2F;jdk1.8.0_191export HADOOP_HOME&#x3D;&#x2F;home&#x2F;kowhoy&#x2F;software&#x2F;hadoop-2.8.5 vim hive-site.xml æ·»åŠ  123456789&lt;property&gt;&lt;name&gt;system:java.io.tmpdir&lt;&#x2F;name&gt;&lt;value&gt;&#x2F;tmp&#x2F;hive&#x2F;java&lt;&#x2F;value&gt;&lt;&#x2F;property&gt;&lt;property&gt;&lt;name&gt;system:user.name&lt;&#x2F;name&gt;&lt;value&gt;$&#123;user.name&#125;&lt;&#x2F;value&gt;&lt;&#x2F;property&gt; ä¿®æ”¹12345678910111213141516171819&lt;property&gt;&lt;name&gt;javax.jdo.option.ConnectionURL&lt;&#x2F;name&gt;&lt;value&gt;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;metastore?createDatabaseIfNotExist&#x3D;true&lt;&#x2F;value&gt;&lt;&#x2F;property&gt;&lt;property&gt;&lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;&#x2F;name&gt;&lt;value&gt;com.mysql.jdbc.Driver&lt;&#x2F;value&gt;&lt;&#x2F;property&gt;&lt;property&gt;&lt;name&gt;javax.jdo.option.ConnectionUserName&lt;&#x2F;name&gt;&lt;value&gt;hive&lt;&#x2F;value&gt;&lt;&#x2F;property&gt;&lt;property&gt;&lt;name&gt;javax.jdo.option.ConnectionPassword&lt;&#x2F;name&gt;&lt;value&gt;passwd&lt;&#x2F;value&gt;&lt;&#x2F;property&gt; å››ã€æ·»åŠ jaråŒ…1cp mysql-connector-java-5.1.48-bin.jar ../apache-hive-2.3.6-bin/lib/ äº”ã€hdfsåˆ›å»ºæ–‡ä»¶å¤¹å¹¶è®¾ç½®æƒé™123456hdfs dfs -mkdir &#x2F;hivehdfs dfs -mkdir &#x2F;hive&#x2F;tmphdfs dfs -mkdir &#x2F;hive&#x2F;loghdfs dfs -mkdir &#x2F;hive&#x2F;warehousehdfs dfs -chmod 777 &#x2F;hive&#x2F;tmp å…­ã€å¼‚å¸¸å¤„ç† å‡ºç°123Failed to open new session: java.lang.RuntimeException:org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.authorize.AuthorizationException): User:xxx not allowed to impersonate anonymous vim ${HADOOP_HOME}/etc/hadoop/core-site.xml 123456789&lt;property&gt;&lt;name&gt;hadoop.proxyuser.xxx.hosts&lt;&#x2F;name&gt;&lt;value&gt;*&lt;&#x2F;value&gt;&lt;&#x2F;property&gt;&lt;property&gt;&lt;name&gt;hadoop.proxyuser.xxx.groups&lt;&#x2F;name&gt;&lt;value&gt;*&lt;&#x2F;value&gt;&lt;&#x2F;property&gt; æŠ¥é”™ä¿¡æ¯ä¸­çš„xxx ä¸é…ç½®ä¸­çš„xxxä¸€è‡´ ä¸ƒã€åˆå§‹åŒ–æ•°æ®åº“1$&#123;HIVE_HOME&#125;&#x2F;bin&#x2F;schematool --dbType mysql --initSchema å…«ã€ä½¿ç”¨ hive-client 1hive beenline å¼€å¯ 1$&#123;HIVE_HOME&#125;/bin/hiveserver2 &amp; è¿æ¥ 1$&#123;HIVE_HOME&#125;/bin/beeline -u jdbc:hive2://localhost:10000 username passwd","categories":[{"name":"å¤§æ•°æ®","slug":"å¤§æ•°æ®","permalink":"http://yoursite.com/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"}],"tags":[{"name":"HIVE","slug":"HIVE","permalink":"http://yoursite.com/tags/HIVE/"}]},{"title":"Pandasè„‘å›¾","slug":"Pandasè„‘å›¾","date":"2020-04-26T10:02:45.000Z","updated":"2020-04-26T10:02:45.508Z","comments":true,"path":"2020/04/26/Pandasè„‘å›¾/","link":"","permalink":"http://yoursite.com/2020/04/26/Pandas%E8%84%91%E5%9B%BE/","excerpt":"","text":"","categories":[{"name":"Pandas","slug":"Pandas","permalink":"http://yoursite.com/categories/Pandas/"},{"name":"Python","slug":"Pandas/Python","permalink":"http://yoursite.com/categories/Pandas/Python/"}],"tags":[{"name":"Pandas","slug":"Pandas","permalink":"http://yoursite.com/tags/Pandas/"}]},{"title":"Numpyè„‘å›¾","slug":"Numpyè„‘å›¾","date":"2020-04-26T10:01:45.000Z","updated":"2020-04-26T10:01:45.596Z","comments":true,"path":"2020/04/26/Numpyè„‘å›¾/","link":"","permalink":"http://yoursite.com/2020/04/26/Numpy%E8%84%91%E5%9B%BE/","excerpt":"","text":"","categories":[{"name":"Numpy","slug":"Numpy","permalink":"http://yoursite.com/categories/Numpy/"},{"name":"Python","slug":"Numpy/Python","permalink":"http://yoursite.com/categories/Numpy/Python/"}],"tags":[{"name":"Numpy","slug":"Numpy","permalink":"http://yoursite.com/tags/Numpy/"}]},{"title":"matplotlibåŸºç¡€å›¾è¡¨","slug":"matplotlibåŸºç¡€å›¾è¡¨","date":"2020-04-26T09:53:07.000Z","updated":"2020-04-26T10:13:45.715Z","comments":true,"path":"2020/04/26/matplotlibåŸºç¡€å›¾è¡¨/","link":"","permalink":"http://yoursite.com/2020/04/26/matplotlib%E5%9F%BA%E7%A1%80%E5%9B%BE%E8%A1%A8/","excerpt":"","text":"matplotlibåŸºç¡€å›¾è¡¨ä¸€ã€æ ¹æ®x,yç»˜åˆ¶12345678910111213import numpy as npfrom matplotlib import pyplot as pltx = np.arange(1, 11)y = x * 2 + 1plt.title(\"demo1\")plt.xlabel(\"x\")plt.ylabel(\"y\")plt.plot(x, y)plt.show() 12345678910111213import numpy as npfrom matplotlib import pyplot as pltx = np.arange(0, 3 * np.pi, 0.1)y = np.sin(x)plt.title(\"demo\")plt.xlabel(\"x\")plt.ylabel(\"y\")plt.plot(x, y, \"om\") #oæŒ‡ä»¥åœ†ç‚¹å±•ç¤º, mè¡¨ç¤ºç«çº¢è‰²plt.show() 123456789101112131415161718192021222324252627282930import numpy as npfrom matplotlib import pyplot as pltp1_x = np.arange(1, 11)p1_y = p1_x * 5 + 8p2_x = np.arange(1, 11)p2_y = p2_x ** 3 + 10p3_x = np.arange(0, 4 * np.pi, 0.1)p3_y = np.sin(p3_x)p4_x = np.arange(0, 4 * np.pi, 0.1)p4_y = np.cos(p4_x)plt.subplot(2, 2, 1) # ä¸¤è¡Œä¸¤åˆ—ç¬¬ä¸€ä¸ªplt.title(\"p1\")plt.plot(p1_x, p1_y, \"om\")plt.subplot(2, 2, 2) # ä¸¤è¡Œä¸¤åˆ—ç¬¬äºŒä¸ªplt.title(\"p2\")plt.plot(p2_x, p2_y, \"pm\")plt.subplot(2, 2, 3)plt.title(\"p3\")plt.plot(p3_x, p3_y)plt.subplot(2, 2, 4)plt.title(\"p4\")plt.plot(p4_x, p4_y) äºŒã€æŸ±çŠ¶å›¾1234567891011121314import numpy as npfrom matplotlib import pyplot as pltb1_x = np.arange(1, 10, 2)b1_y = b1_x * 2 + 10b2_x = np.arange(2, 11, 2)b2_y = b2_x * 3 + 2plt.bar(b1_x, b1_y, color=\"m\", align='center')plt.bar(b2_x, b2_y, color=\"b\", align=\"center\")plt.title(\"bar_demo\")plt.show() ä¸‰ã€ ç›´æ–¹å›¾12345678910import numpy as npfrom matplotlib import pyplot as plta = np.random.randint(50, size=100)plt.hist(a, bins=[0, 10, 20, 30, 40, 50])plt.title(\"histogram\")plt.show() å››ã€æ•£ç‚¹å›¾12345678import numpy as npfrom matplotlib import pyplot as pltx = np.random.randn(1000)y = np.random.randn(1000)plt.plot(x, y, \"om\")plt.show() 12345678import numpy as npfrom matplotlib import pyplot as pltx = np.random.randn(1000)y = np.random.randn(1000)plt.scatter(x, y)plt.show()","categories":[{"name":"Python","slug":"Python","permalink":"http://yoursite.com/categories/Python/"}],"tags":[{"name":"python","slug":"python","permalink":"http://yoursite.com/tags/python/"},{"name":"matplotlib","slug":"matplotlib","permalink":"http://yoursite.com/tags/matplotlib/"}]},{"title":"hadoopäº‘æœåŠ¡å™¨åˆ†å¸ƒå¼å®‰è£…é…ç½®","slug":"hadoopäº‘æœåŠ¡å™¨åˆ†å¸ƒå¼å®‰è£…é…ç½®","date":"2020-04-22T06:10:42.000Z","updated":"2020-04-22T06:10:42.489Z","comments":true,"path":"2020/04/22/hadoopäº‘æœåŠ¡å™¨åˆ†å¸ƒå¼å®‰è£…é…ç½®/","link":"","permalink":"http://yoursite.com/2020/04/22/hadoop%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/","excerpt":"","text":"hadoopäº‘æœåŠ¡å™¨åˆ†å¸ƒå¼å®‰è£…é…ç½® åœ¨ä¸‰å°äº‘æœåŠ¡å™¨ä¸Šæ­å»ºhadoopé›†ç¾¤, 1master + 2slaveä½¿ç”¨ç‰ˆæœ¬: hadoop-3.2.1ã€jdk1.8.0_191ã€ scala-2.13.1âš ï¸ jdk11ç‰ˆæœ¬ä¼šå‡ºç°Caused by: java.lang.NoClassDefFoundError: javax/activation/DataSourceé”™è¯¯ï¼Œè¿˜æ˜¯é€‰æ‹©äº†ä½ç‰ˆæœ¬ ä¸€ã€æœåŠ¡å™¨åˆ›å»ºç”¨æˆ·è®¾ç½®å¯†ç ã€é…ç½®äº’ç›¸ä¹‹é—´å…å¯†ç™»å½•** âš ï¸ æœåŠ¡å™¨çš„hostname ä»¥åŠ /etc/hostsä¸­é…ç½®çš„hostname å‡ä¸å¯å¸¦_ä¸‹åˆ’çº¿ ** ä¸€ã€ä¸‹è½½å®‰è£…åŒ…(ä½¿ç”¨å›½å†…é•œåƒ)script12345wget https://mirrors.huaweicloud.com/java/jdk/8u191-b12/jdk-8u191-linux-x64.tar.gzwget https://downloads.lightbend.com/scala/2.13.1/scala-2.13.1.tgzwget https://mirrors.huaweicloud.com/apache/hadoop/common/hadoop-3.2.1/hadoop-3.2.1.tar.gz äºŒã€è§£å‹é…ç½®ç¯å¢ƒå˜é‡script12345678910export SCALA_HOME=/home/kowhoy/software/scala-2.13.1export PATH=$SCALA_HOME/bin:$PATHexport HADOOP_HOME=/home/kowhoy/software/hadoop-3.2.1export PATH=$HADOOP_HOME/bin:$PATHJAVA_HOME=/home/kowhoy/software/jdk1.8.0_191JRE_HOME=/home/kowhoy/software/jdk1.8.0_191/jreexport CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/libexport PATH=$JAVA_HOME/bin:$PATH ä¸‰å°æœåŠ¡å™¨å‡è¿›è¡Œä»¥ä¸Šæ“ä½œ ä¸‰ã€é…ç½®master,åŒæ­¥ç»™slave é…ç½®æ–‡ä»¶çš„æ ¹ç›®å½• $HADOOP_HOME/etc/hadoopé…ç½®æ–‡ä»¶ä¸­æ¶‰åŠåˆ°çš„æ–‡ä»¶å¤¹ï¼Œéœ€è¦è‡ªè¡Œåˆ›å»º hadoop-env.sh script1export JAVA_HOME=/home/kowhoy/software/jdk1.8.0_191 core-site.xml 12345678910111213&lt;configuration&gt; &lt;property&gt; &lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;value&gt;hdfs://master:9000&lt;/value&gt; &lt;description&gt;hdfsurl&lt;/description&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/home/kowhoy/software/hadoop-3.2.1/tmp&lt;/value&gt; &lt;description&gt;ä¸´æ—¶æ–‡ä»¶è·¯å¾„&lt;/description&gt; &lt;/property&gt;&lt;/configuration&gt; hdfs-site.xml 1234567891011121314151617181920212223242526&lt;configuration&gt; &lt;property&gt; &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt; &lt;value&gt;master:50090&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt; &lt;value&gt;/home/kowhoy/software/hadoop-3.2.1/dfs/name&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt; &lt;value&gt;/home/kowhoy/software/hadoop-3.2.1/dfs/data&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.namenode.checkpoint.dir&lt;/name&gt; &lt;value&gt;/home/kowhoy/software/hadoop-3.2.1/dfs/namesecondary&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;dfs.replication&lt;/name&gt; &lt;value&gt;3&lt;/value&gt; &lt;decription&gt;master + slaveä¸ªæ•°&lt;/decription&gt; &lt;/property&gt;&lt;/configuration&gt; mapred-site.xml 123456&lt;configuration&gt; &lt;property&gt; &lt;name&gt;mapreduce.framework.name&lt;/name&gt; &lt;value&gt;yarn&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; yarn-site.xml 12345678910111213&lt;configuration&gt;&lt;!-- Site specific YARN configuration properties --&gt; &lt;property&gt; &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; &lt;value&gt;mapreduce_shuffle&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt; &lt;value&gt;master&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; workerså†™é…ç½®çš„slave 12ecs00bcc00 mastersæ–‡ä»¶æ˜¯æ²¡æœ‰çš„ï¼Œé»˜è®¤masterçš„hostsé…ç½®åº”è¯¥æ˜¯ masterï¼Œå¦‚æœä¸æ˜¯ï¼Œå¯èƒ½æ˜¯åœ¨mastersæ–‡ä»¶ä¸­é…ç½®ï¼Œæœªæµ‹è¯• ä»¥ä¸Šé…ç½®å¯scpåˆ°slaveä¸Šï¼Œæ³¨æ„å¦‚æœhostnameä¸ä¸€è‡´ï¼Œéœ€è¦ä¿®æ”¹ å››ã€å¯åŠ¨é›†ç¾¤ æ ¼å¼åŒ– script1hadoop namenode -format å¯åŠ¨ script1$&#123;HADOOP_HOME&#125;/sbin/start_all.sh jpsæŸ¥çœ‹ script12345678910#master25189 NameNode25638 ResourceManager25417 SecondaryNameNode26638 Jps#slave21406 NodeManager23646 Jps21278 DataNode äº”ã€è¡¥å……å¦‚æœ‰é”™è¯¯ï¼ŒæŸ¥çœ‹${HADOOP_HOME}/logsä¸‹çš„æ—¥å¿—ï¼Œdatanodeç›¸å…³æ—¥å¿—æ˜¯åœ¨slaveä¸Š","categories":[{"name":"hadoop","slug":"hadoop","permalink":"http://yoursite.com/categories/hadoop/"}],"tags":[{"name":"hadoop","slug":"hadoop","permalink":"http://yoursite.com/tags/hadoop/"}]},{"title":"Scalaæ¨¡å¼åŒ¹é…","slug":"Scalaæ¨¡å¼åŒ¹é…","date":"2020-04-21T07:01:32.000Z","updated":"2020-04-21T07:01:32.883Z","comments":true,"path":"2020/04/21/Scalaæ¨¡å¼åŒ¹é…/","link":"","permalink":"http://yoursite.com/2020/04/21/Scala%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/","excerpt":"","text":"æ¨¡å¼åŒ¹é…12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879package com.kowhoy.scalaimport scala.util.Random// æ¨¡å¼åŒ¹é…object MatchDemo &#123; def main(args: Array[String]): Unit = &#123; // åŸºç¡€åŒ¹é… basic_match() // æ¡ä»¶åŒ¹é… condition_match() // ç±»å‹åŒ¹é… type_match(List(1,2,4)) type_match(12) type_match(1.2) // arrayåŒ¹é… array_match(Array()) // å¼‚å¸¸å¤„ç† error_exception_match() &#125; def basic_match(): Unit = &#123; val names = Array(\"A\", \"B\", \"C\") val name = names(Random.nextInt(names.length)) name match &#123; case \"A\" =&gt; println(\"AAAA\") case \"B\" =&gt; println(\"BBBB\") case _ =&gt; println(\"CCCCC\") &#125; &#125; def condition_match(): Unit = &#123; val names = Array(\"A\", \"B\", \"C\") val name = names(Random.nextInt(names.length))// name = \"C\" val buff = \"red\" name match &#123; case \"A\" =&gt; println(\"A\") case \"B\" =&gt; println(\"B\") case _ if(buff == \"red\") =&gt; println(\"D\") case _ =&gt; println(\"C\") &#125; &#125; def type_match(data:Any): Unit = &#123; data match &#123; case x:Int =&gt; println(\"INT\") case x:String =&gt; println(\"String\") case x:List[Any] =&gt; println(\"List\") case _ =&gt; println(\"other\") &#125; &#125; def array_match(array:Array[String]): Unit = &#123; array match &#123; case Array(\"abc\") =&gt; println(\"type1_abc\") case Array(x, y) =&gt; println(\"type2:\", x, y) case Array(x, _*) =&gt; println(\"type3\", x) case _ =&gt; println(\"other\") &#125; &#125; def error_exception_match(): Unit = &#123; try &#123; val d = 10 / 0 &#125; catch &#123; case e: ArithmeticException =&gt; println(\"error0\") case e: Exception =&gt; println(e.getStackTrace) &#125; finally &#123; println(\"Aaaaaaa\") &#125; &#125;&#125;","categories":[{"name":"Scala","slug":"Scala","permalink":"http://yoursite.com/categories/Scala/"}],"tags":[{"name":"scala","slug":"scala","permalink":"http://yoursite.com/tags/scala/"}]},{"title":"æŸ¯é‡ŒåŒ–","slug":"æŸ¯é‡ŒåŒ–","date":"2020-04-15T10:29:12.000Z","updated":"2020-04-15T10:29:12.110Z","comments":true,"path":"2020/04/15/æŸ¯é‡ŒåŒ–/","link":"","permalink":"http://yoursite.com/2020/04/15/%E6%9F%AF%E9%87%8C%E5%8C%96/","excerpt":"","text":"æŸ¯é‡ŒåŒ–å®šä¹‰ å°†åŸæ¥å¤šä¸ªå‚æ•°çš„å‡½æ•°ï¼Œåˆ†æˆå¤šä¸ªå•ä¸ªå‚æ•°çš„å‡½æ•° å¥½å¤„ å¤æ‚é€»è¾‘ç®€å•åŒ– ç¤ºä¾‹12345678910111213141516171819package com.kowhoy.scala//æŸ¯é‡ŒåŒ–object keli &#123; def main(args: Array[String]): Unit = &#123; var inc = (x:Int, y:Int) =&gt; x + y println(inc(1, 2)) println(inc_kl(1)(2)) var firstNum = inc_kl((1))_ var res = firstNum(2) println(res) &#125; def inc_kl(x:Int)(y:Int) = &#123; x + y &#125;&#125; æ³¨æ„ å½“åªä¼ é€’éƒ¨åˆ†å‚æ•°ç”Ÿäº§å‡½æ•°çš„æ—¶å€™ï¼Œéœ€è¦ç”¨å ä½ç¬¦_è¡¥å……åé¢çš„å‚æ•°","categories":[{"name":"Scala","slug":"Scala","permalink":"http://yoursite.com/categories/Scala/"}],"tags":[{"name":"scala","slug":"scala","permalink":"http://yoursite.com/tags/scala/"}]},{"title":"åŒ¿åå‡½æ•°","slug":"åŒ¿åå‡½æ•°","date":"2020-04-15T10:28:45.000Z","updated":"2020-04-15T10:28:45.241Z","comments":true,"path":"2020/04/15/åŒ¿åå‡½æ•°/","link":"","permalink":"http://yoursite.com/2020/04/15/%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0/","excerpt":"","text":"åŒ¿åå‡½æ•° ç®€å†™å‡½æ•°å®šä¹‰, åŒ¿åå‡½æ•°ä¸å¯ä»¥å†™æˆä¼ åè°ƒç”¨ 12345678910111213141516171819202122232425262728293031package com.kowhoy.scala//åŒ¿åå‡½æ•°object niming &#123; def main(args: Array[String]): Unit = &#123; var initNum = 0 var counter = () =&gt; &#123; initNum += 1 initNum &#125; var sendValue = (x: Int) =&gt; &#123; for (i &lt;- 0 to 5) &#123; println(x) &#125; &#125; sendValue(counter()) sendName(counter()) &#125; def sendName(x: =&gt; Int) = &#123; for (i &lt;- 0 to 5) &#123; println(x) &#125; &#125;&#125;","categories":[{"name":"Scala","slug":"Scala","permalink":"http://yoursite.com/categories/Scala/"}],"tags":[{"name":"scala","slug":"scala","permalink":"http://yoursite.com/tags/scala/"}]},{"title":"ä¼ å€¼ä¼ åè°ƒç”¨","slug":"ä¼ å€¼ä¼ åè°ƒç”¨","date":"2020-04-15T10:28:02.000Z","updated":"2020-04-15T10:28:02.982Z","comments":true,"path":"2020/04/15/ä¼ å€¼ä¼ åè°ƒç”¨/","link":"","permalink":"http://yoursite.com/2020/04/15/%E4%BC%A0%E5%80%BC%E4%BC%A0%E5%90%8D%E8%B0%83%E7%94%A8/","excerpt":"","text":"ä¼ å€¼ä¼ åè°ƒç”¨ ä¼ å€¼ name:type è®¡ç®—å¥½å€¼è¿›è¡Œè°ƒç”¨ ä¼ å name: =&gt; typeåœ¨è°ƒç”¨å¤„å†è¿›è¡Œè®¡ç®— 12345678910111213141516171819202122232425262728293031323334package com.kowhoy.scala// ä¼ å€¼è°ƒç”¨å’Œä¼ åè°ƒç”¨object sendWay &#123; var initNum = 0 def main(args: Array[String]):Unit = &#123; sendName(counter) println(\"--\" * 20) initNum = 0 sendValue(counter) &#125; def counter:Int = &#123; initNum += 1 initNum &#125; def sendName(x: =&gt; Int) :Unit = &#123; for (i &lt;- 0 to 5) &#123; println(x) &#125; &#125; def sendValue(x: Int) :Unit = &#123; for (i &lt;- 0 to 5) &#123; println(x) &#125; &#125;&#125; 12345678910111213123456----------------------------------------111111","categories":[{"name":"Scala","slug":"Scala","permalink":"http://yoursite.com/categories/Scala/"}],"tags":[{"name":"scala","slug":"scala","permalink":"http://yoursite.com/tags/scala/"}]},{"title":"scalaå˜é•¿å‚æ•°","slug":"scalaå˜é•¿å‚æ•°","date":"2020-04-15T10:27:19.000Z","updated":"2020-04-15T10:27:19.716Z","comments":true,"path":"2020/04/15/scalaå˜é•¿å‚æ•°/","link":"","permalink":"http://yoursite.com/2020/04/15/scala%E5%8F%98%E9%95%BF%E5%8F%82%E6%95%B0/","excerpt":"","text":"å˜é•¿å‚æ•° å‡½æ•°çš„å‚æ•°å¯ä»¥è®¾ç½®ä¸ºå¤šä¸ªåŒç§ç±»å‹æˆ–ä¸åŒç±»å‹çš„å‚æ•° 1234567891011121314151617181920212223242526272829303132333435363738package com.kowhoy.scala//å˜é•¿å‚æ•°, å¯å˜å‚æ•°object varargs &#123; def main(args: Array[String]): Unit = &#123; var numsSum = sumargs(1, 1, 3, 4, 5, 6) println(numsSum) var minusRight = minusargs(\"right\", 5, 4, 3, 2, 1) // 5 4 3 (2 -1 ) =&gt; 5 - 4 - (3-1) =&gt; 5 - 4 - 2 =&gt; 5 - 2 =&gt; 3 var minusLeft = minusargs(\"left\", 5, 4, 3, 2, 1) println(minusRight, minusLeft) anyArgs(\"abc\", 123) &#125; def sumargs(args: Int*):Int = &#123; var res = args.reduceLeft(_+_) res &#125; def minusargs(minuDirction:String, args: Int*):Int = &#123; var res = 0 if (minuDirction == \"right\") &#123; res = args.reduceRight(_-_) &#125; else if (minuDirction == \"left\") &#123; res = args.reduceLeft(_-_) &#125; res &#125; def anyArgs(args: Any*):Unit = &#123; args.foreach(println) &#125;&#125; reduceLeft / reduceRight","categories":[{"name":"Scala","slug":"Scala","permalink":"http://yoursite.com/categories/Scala/"}],"tags":[{"name":"scala","slug":"scala","permalink":"http://yoursite.com/tags/scala/"}]},{"title":"Scalaä¸­çš„lazyä½¿ç”¨","slug":"Scalaä¸­çš„lazyä½¿ç”¨","date":"2020-04-15T10:26:21.000Z","updated":"2020-04-15T10:26:21.267Z","comments":true,"path":"2020/04/15/Scalaä¸­çš„lazyä½¿ç”¨/","link":"","permalink":"http://yoursite.com/2020/04/15/Scala%E4%B8%AD%E7%9A%84lazy%E4%BD%BF%E7%94%A8/","excerpt":"","text":"Scalaä¸­çš„lazyä½¿ç”¨ä»€ä¹ˆæ˜¯lazy lazyç”¨åœ¨èµ‹å€¼çš„æ—¶å€™ï¼Œç›®çš„æ˜¯ä¸ºäº†åœ¨èµ‹å€¼å˜é‡çœŸæ­£è¢«ä½¿ç”¨çš„æ—¶å€™ï¼Œæ‰ä¼šè¿›è¡Œå˜é‡èµ‹å€¼å¤„ç† ç¤ºä¾‹12345678910111213141516171819202122232425262728293031323334353637383940414243//lazyèµ‹å€¼package com.kowhoy.scalaobject Lazy &#123; def main(args: Array[String]): Unit = &#123; withNoLazy.run() println(\"--\"*20) withLazy.run() &#125;&#125;object withNoLazy &#123; def init(): Int = &#123; println(\"éæƒ°æ€§èµ‹å€¼\") 0 &#125; def run(): Unit = &#123; val initNum = init() println(\"Start...\") println(initNum) println(\"End...\") &#125;&#125;object withLazy &#123; def init(): Int = &#123; println(\"æƒ°æ€§èµ‹å€¼\") 0 &#125; def run(): Unit = &#123; lazy val initNum = init() println(\"Start...\") println(initNum) println(\"End...\") &#125;&#125; ä¸Šæ–‡çš„è¾“å‡ºå¦‚ä¸‹123456789éæƒ°æ€§èµ‹å€¼Start...0End...----------------------------------------Start...æƒ°æ€§èµ‹å€¼0End... æ³¨æ„ ä½¿ç”¨lazyèµ‹å€¼çš„å˜é‡åªèƒ½æ˜¯valå£°æ˜çš„lazy modifier allowed only with value definitions","categories":[{"name":"scala","slug":"scala","permalink":"http://yoursite.com/categories/scala/"}],"tags":[{"name":"scala","slug":"scala","permalink":"http://yoursite.com/tags/scala/"}]},{"title":"mysqlåˆ†ç»„topä¼˜åŒ–","slug":"mysqlåˆ†ç»„topä¼˜åŒ–","date":"2020-04-14T08:26:35.000Z","updated":"2020-04-14T08:26:35.915Z","comments":true,"path":"2020/04/14/mysqlåˆ†ç»„topä¼˜åŒ–/","link":"","permalink":"http://yoursite.com/2020/04/14/mysql%E5%88%86%E7%BB%84top%E4%BC%98%E5%8C%96/","excerpt":"","text":"mysqlåˆ†ç»„topä¼˜åŒ– mysqlåˆ†ç»„å–top1 é€šå¸¸æ˜¯ç”¨max() ç„¶åå†…è¿ å¯ä»¥ä½¿ç”¨å˜é‡çš„æ–¹å¼é¿å…joinæ“ä½œ é—®é¢˜åœºæ™¯åŒä¸€ç»„oss_id, osp_id, pro_sku_code, start_time ä¼šæœ‰å¤šç§ price_val,å…ˆéœ€è¦ä¾æ®update_timeå­—æ®µå–æ¯ä¸€ç»„çš„æœ€åä¸€æ¡æ›´æ–°å†…å®¹ åŸå§‹å†™æ³•123456789101112select a.osp_id, a.oss_id, a.pro_sku_code, a.price_val, a.start_time from pricing.price_log a,( select max(update_time) as max_up, oss_id, osp_id, pro_sku_code, start_time from pricing.price_log where price_type = 10 AND STATUS = 1 AND delete_flag = 0 group by oss_id, osp_id, pro_sku_code, start_time ) b where a.oss_id = b.oss_id and a.osp_id = b.osp_id and a.pro_sku_code = b.pro_sku_code and a.start_time = b.start_time and a.update_time = b.max_up and a.price_type = 10 and a.status = 1 and a.delete_flag = 0 150wæ•°æ®10minæ‰§è¡Œæ—¶é—´ * ä½¿ç”¨å˜é‡å†™æ³•1234567891011121314151617181920set @sameno := 1;set @oss_id := -1;set @osp_id := -1;set @pro_sku_code := \"\";set @start_time := \"1970-01-01\";select oss_id, osp_id, pro_sku_code, start_time, price_val from (select @sameno := case when @oss_id = oss_id and @osp_id = osp_id and @pro_sku_code = pro_sku_code and @start_time = start_time then @sameno + 1 else 1 end as sameno, @oss_id := oss_id oss_id, @osp_id := osp_id osp_id, @pro_sku_code := pro_sku_code pro_sku_code, @start_time := start_time start_time, price_valfrom(selectoss_id, osp_id, pro_sku_code, start_time, price_valfrom price_log where price_type = 10 and status = 1 and delete_flag = 0 order byoss_id, osp_id, pro_sku_code, start_time, update_time desc ) a) b where sameno = 1 30så·¦å³ * âš ï¸ éœ€è¦å…ˆè®¾å®šå¤´éƒ¨åˆå§‹å˜é‡ï¼Œå¦åˆ™é¦–æ¬¡æ‰§è¡Œç»“æœéé¢„æœŸï¼Œå¤šæ¬¡æ‰§è¡Œæ•ˆæœä¸ä¸€è‡´ï¼Œå¾ˆå¥‡æ€ª ä½¿ç”¨pythonæ“ä½œ ä¸å¯ä½¿ç”¨pd.read_sql_query() æœ‰å¼‚å¸¸ 1234567891011121314151617181920212223242526272829sql = ''' select oss_id, osp_id, pro_sku_code, start_time, price_val from ( select @sameno := case when @oss_id = oss_id and @osp_id = osp_id and @pro_sku_code = pro_sku_code and @start_time = start_time then @sameno + 1 else 1 end as sameno, @oss_id := oss_id oss_id, @osp_id := osp_id osp_id, @pro_sku_code := pro_sku_code pro_sku_code, @start_time := start_time start_time, price_val from (select oss_id, osp_id, pro_sku_code, start_time, price_val from price_log where price_type = 10 and status = 1 and delete_flag = 0 order by oss_id, osp_id, pro_sku_code, start_time, update_time desc ) a) b where sameno = 1 ''' db_conf = conf.db_conf oms_conf = db_conf['oms_db'] db = pymysql.connect(oms_conf['host'], oms_conf['user'], oms_conf['passwd'], 'pricing') heads = [\"set @sameno := 1;\", \"set @oss_id := -1;\", \"set @osp_id := -1;\", \"set @pro_sku_code := '';\", \"set @start_time := '1970-01-01'\"] cursor = db.cursor() for col in heads: cursor.execute(col) cursor.execute(sql) res = cursor.fetchall() è¿˜å¯ä»¥ä½¿ç”¨ç¨‹åºå†…è¿›è¡Œç­›é€‰ï¼Œä¸è¿‡æ•ˆç‡å¹¶ä¸é«˜ï¼Œä½†æ˜¯æ¯”maxè¦å¥½","categories":[{"name":"mysql","slug":"mysql","permalink":"http://yoursite.com/categories/mysql/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"http://yoursite.com/tags/mysql/"}]},{"title":"é…ç½®æ•°æ®ç®¡ç†æŸ¥è¯¢","slug":"é…ç½®æ•°æ®ç®¡ç†æŸ¥è¯¢","date":"2020-04-10T10:05:02.000Z","updated":"2020-04-10T10:16:55.898Z","comments":true,"path":"2020/04/10/é…ç½®æ•°æ®ç®¡ç†æŸ¥è¯¢/","link":"","permalink":"http://yoursite.com/2020/04/10/%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E6%9F%A5%E8%AF%A2/","excerpt":"","text":"é…ç½®æ•°æ®ç®¡ç†æŸ¥è¯¢ èƒŒæ™¯: æ•°æ®åº“ä»¥åŠæœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯æ¯”è¾ƒå¤šï¼Œä¸´æ—¶ä½¿ç”¨é¢‘ç‡ä¹Ÿé«˜,æ‰¾èµ·æ¥ä¸æ–¹ä¾¿ pylsy configparser catconfig.py12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576import sysfrom pylsy import pylsytableimport configparsercp &#x3D; configparser.ConfigParser()cp.read(&quot;&#x2F;Users&#x2F;zhouke&#x2F;code&#x2F;catconfig&#x2F;catconfig.cfg&quot;)cp_sections &#x3D; cp.sections()config_dict &#x3D; &#123;&#125;for section in cp_sections: name &#x3D; section.split(&quot;:&quot;)[0] if name not in config_dict: config_dict[name] &#x3D; [] config_data &#x3D; cp._sections[section] config_dict[name].append(config_data)match_dict &#x3D; &#123; &quot;db_51&quot;:[&quot;51&quot;, &quot;ç”Ÿäº§&quot;], &quot;db_69&quot;:[&quot;db_69&quot;], &quot;db_oms&quot;:[&quot;oms&quot;], &quot;db_oil&quot;:[&quot;oil&quot;], &quot;db_oil_test&quot;:[&quot;oil_test&quot;], &quot;db_ygh&quot;:[&quot;ygh&quot;, &quot;petrol&quot;], &quot;db_cd&quot;:[&quot;db_cd&quot;, &quot;db_ç¦…é“&quot;, &quot;cd&quot;, &quot;ç¦…é“&quot;], &quot;db_yzg&quot;:[&quot;yzg&quot;], &quot;db_yzg_test&quot;:[&quot;yzg_test&quot;], &quot;mail_data&quot;:[&quot;mail&quot;], &quot;web_datav&quot;:[&quot;datav&quot;], &quot;web_ali&quot;:[&quot;zy_ali&quot;], &quot;tm&quot;:[&quot;teamview&quot;, &quot;teamviewer&quot;, &quot;tm&quot;], &quot;s_69&quot;:[&quot;s_69&quot;, &quot;69&quot;], &quot;s_jump&quot;:[&quot;jump&quot;, &quot;jumper&quot;, &quot;2222&quot;], &quot;s_cd&quot;:[&quot;s_cd&quot;, &quot;s_ç¦…é“&quot;], &quot;s_54&quot;:[&quot;54&quot;, &quot;s_54&quot;], &quot;s_56&quot;:[&quot;56&quot;, &quot;s_56&quot;, &quot;win&quot;, &quot;windows&quot;], &quot;s_ali&quot;:[&quot;ali&quot;], &quot;s_bcc&quot;:[&quot;bcc&quot;, &quot;baidu&quot;, &quot;s_bcc&quot;], &quot;db_bcc&quot;:[&quot;db_bcc&quot;], &quot;wx&quot;:[&quot;wx&quot;, &quot;wx_mail&quot;], &quot;bk&quot;:[&quot;bucket&quot;, &quot;bos&quot;], &quot;tab&quot;:[&quot;tableau&quot;, &quot;license&quot;, &quot;tab&quot;]&#125;find_dict &#x3D; &#123;&#125;for name, alias_list in match_dict.items(): for idx, alias in enumerate(alias_list): find_dict[alias] &#x3D; name find_dict[name.split(&quot;_&quot;)[0] + alias] &#x3D; namesearch_str &#x3D; sys.argv[1]if search_str not in find_dict: print(&quot;ğŸˆšï¸&quot;)else: config_res &#x3D; config_dict[find_dict[search_str]] table_dict &#x3D; &#123;&#125; for idx, row in enumerate(config_res): for k, v in row.items(): if k not in table_dict: table_dict[k] &#x3D; [] table_dict[k].append(v) table_head &#x3D; list(table_dict.keys()) table &#x3D; pylsytable(table_head) for k, v in table_dict.items(): table.add_data(k, v) print(table) catconfig.cfg 123456789[db_a:1]host &#x3D; 111user &#x3D; 111passwd &#x3D; 111[db_a:2]host &#x3D; 111user &#x3D; 222passwd &#x3D; 222 catconfig.sh 12#!&#x2F;bin&#x2F;bashpython &#x2F;Users&#x2F;zhouke&#x2F;code&#x2F;catconfig&#x2F;catconfig.py $1 æ·»åŠ å…¨å±€å‘½ä»¤ 1sudo ln -s &#x2F;Users&#x2F;zhouke&#x2F;code&#x2F;catconfig&#x2F;catconfig.sh &#x2F;usr&#x2F;local&#x2F;bin&#x2F;catconfig ä½¿ç”¨ 1catconfig a ## a: é…ç½®çš„æ˜ å°„å­—æ®µ æ•ˆæœ","categories":[{"name":"Python","slug":"Python","permalink":"http://yoursite.com/categories/Python/"}],"tags":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"http://yoursite.com/tags/%E5%B7%A5%E5%85%B7/"}]},{"title":"uwsgi+nginxéƒ¨ç½²flask","slug":"uwsgi-nginxéƒ¨ç½²flask","date":"2020-04-10T09:54:21.000Z","updated":"2020-04-10T10:14:43.268Z","comments":true,"path":"2020/04/10/uwsgi-nginxéƒ¨ç½²flask/","link":"","permalink":"http://yoursite.com/2020/04/10/uwsgi-nginx%E9%83%A8%E7%BD%B2flask/","excerpt":"","text":"uwsgi + nginxéƒ¨ç½²flaskä¸€ã€å®‰è£…uwsgi ä½¿ç”¨pythonç‰ˆæœ¬å¯¹åº”çš„pipè¿›è¡Œå®‰è£…uwsgi 1pip install uwsgi åœ¨é¡¹ç›®ä¸‹åˆ›å»ºuwsgi.iniæ–‡ä»¶ 12345678910111213[uwsgi]http &#x3D; 0.0.0.0:5000pythonpath &#x3D; &#x2F;home&#x2F;anaconda3&#x2F;bin&#x2F;pythonchdir &#x3D; &#x2F;home&#x2F;code&#x2F;apiwsgi-file &#x3D; app.pycallable &#x3D; appprocesses &#x3D; 4threads &#x3D; 2stats &#x3D; 127.0.0.1:9191pidfile &#x3D; uwsgi.piddeamonize &#x3D; .&#x2F;log&#x2F;uwsgi.loglazy-apps &#x3D; truetouch-chain-reload &#x3D; true åå°è¿è¡Œuwsgi 1uwsgi -d --ini uwsgi.ini äºŒã€å®‰è£…é…ç½®nginx ä¸‹è½½å®‰è£…åŒ… 1wget http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.17.9.tar.gz è§£å‹ï¼Œä¸è¦æ”¾åˆ°/usr/localä¸‹ï¼Œä¼šå®‰è£…åˆ°è¿™ä¸ªç›®å½• 1tar -zxvf nginx-1.17.9.tar.gz æŸ¥çœ‹ç¯å¢ƒæ˜¯å¦æ»¡è¶³ 123456789101112131415cd nginx-1.17.9&#x2F;.&#x2F;configure##ä¸å‡ºç°erroråˆ™æ»¡è¶³##å¦åˆ™æ£€æŸ¥ä¾èµ–åº“#ä¾èµ–åº“å®‰è£…sudo yum install gcc-c++sudo yum install pcresudo yum install pcre-develsudo yum install zlibsudo yum install zlib-develsudo yum install opensslsudo yum install openssl-devel æ— é”™è¯¯è¿›è¡Œç¼–è¯‘ 123makesudo make install ä¸‰ã€é…ç½®nginx è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ /usr/local/nginx/conf/conf.d/api.conf 12345678910111213141516171819202122232425262728upstream project&#123; server localhost:5000;&#125;server &#123; listen 8080; server_name IP&#x2F;localhost; access_log &#x2F;home&#x2F;api&#x2F;access.log; error_log &#x2F;home&#x2F;api&#x2F;error.log; location &#x2F; &#123; proxy_pass http:&#x2F;&#x2F;project; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504; proxy_max_temp_file_size 0; proxy_connect_timeout 90; proxy_send_timeout 90; proxy_read_timeout 90; proxy_buffer_size 4k; proxy_buffers 4 32k; proxy_busy_buffers_size 64k; proxy_temp_file_write_size 64k; &#125;&#125; é…ç½®/usr/local/nginx/conf/nginx.conf 12##åœ¨httpä¸‹é¢åŠ ä¸Šinclude &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;conf.d&#x2F;*.conf; é…ç½®å¼€æœºå¯åŠ¨ 1234567891011121314151617vim &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service[Unit]Description&#x3D;nginxAfter&#x3D;network.target[Service]Type&#x3D;forkingExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginxExecReload&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx reloadExecStop&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx quitPrivateTmp&#x3D;true[Install]WantedBy&#x3D;multi-user.targetsystemctl enable nginx.service å¯åŠ¨nginx 1systemctl start nginx","categories":[{"name":"nginx","slug":"nginx","permalink":"http://yoursite.com/categories/nginx/"},{"name":"uwsgi","slug":"nginx/uwsgi","permalink":"http://yoursite.com/categories/nginx/uwsgi/"}],"tags":[{"name":"uwsgi","slug":"uwsgi","permalink":"http://yoursite.com/tags/uwsgi/"},{"name":"nginx","slug":"nginx","permalink":"http://yoursite.com/tags/nginx/"}]},{"title":"ElasticsearchåŸºç¡€ä½¿ç”¨","slug":"ElasticsearchåŸºç¡€ä½¿ç”¨","date":"2020-04-02T08:23:17.000Z","updated":"2020-04-02T10:22:04.764Z","comments":true,"path":"2020/04/02/ElasticsearchåŸºç¡€ä½¿ç”¨/","link":"","permalink":"http://yoursite.com/2020/04/02/Elasticsearch%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/","excerpt":"","text":"ElasticsearchåŸºç¡€ä½¿ç”¨ä¸€ã€å®‰è£… éœ€è¦javaç¯å¢ƒ ä¸‹è½½å®‰è£…åŒ… 1wget https:&#x2F;&#x2F;mirrors.huaweicloud.com&#x2F;elasticsearch&#x2F;7.6.1&#x2F;elasticsearch-7.6.1-linux-x86_64.tar.gz è§£å‹ï¼Œé…ç½®ç¯å¢ƒå˜é‡ 12345tar -zxvf elasticsearch-7.6.1-linux-x86_64.tar.gz#~&#x2F;.bash_profileexport ELASTICSEARCH_PATH&#x3D;&#x2F;home&#x2F;kowhoy&#x2F;software&#x2F;elasticsearch-7.6.1export PATH&#x3D;$&#123;ELASTICSEARCH_PATH&#125;&#x2F;bin:$PATH å¯åŠ¨ 1elasticsearch æ£€æŸ¥ 12#å¦å¯ç»ˆç«¯curl &#39;http:&#x2F;&#x2F;localhost:9200&#x2F;?pretty&#39; äºŒã€åŸºç¡€æ¦‚å¿µ elasticsearchä¸­çš„æ¦‚å¿µä¸å…³ç³»å‹æ•°æ®åº“çš„æ¦‚å¿µç±»æ¯”: å…³ç³»å‹æ•°æ®åº“ elasticsearch databases indices tables types rows documents cloumns fields ä¸‰ã€åŸºç¡€ä½¿ç”¨ æœ¬ç¯‡ä½¿ç”¨çš„æ˜¯insomniaå·¥å…·ç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªç±»ä¼¼ä»¥ä¸‹å…³ç³»å‹æ•°æ®åº“ç»“æ„çš„Elasticsearch ç±»å‹ åç§° database-name history-demo table-name shell column-1-name command column-2-name create-by åˆ›å»ºindex 12345678910111213141516171819202122232425262728@method: PUT@url: http://localhost:9200/history_demo@return: &#123; \"acknowledged\": true, \"shards_acknowledged\": true, \"index\": \"history_demo\"&#125;or##å†™å…¥æ•°æ®çš„åŒæ—¶ä¹Ÿåˆ›å»ºindex@method: PUT@url: http://localhost:9200/history_demo/shell/1@data: &#123;\"command\":\"df -h\"&#125;@return: &#123; \"_index\": \"history_demo\", \"_type\": \"shell\", \"_id\": \"1\", \"_version\": 1, \"result\": \"created\", \"_shards\": &#123; \"total\": 2, \"successful\": 1, \"failed\": 0 &#125;, \"_seq_no\": 0, \"_primary_term\": 1&#125; æŸ¥çœ‹indices 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748##æŸ¥çœ‹æŒ‡å®šçš„index@method: GET@url: http://localhost:9200/history_demo@return: &#123; \"history_demo\": &#123; \"aliases\": &#123;&#125;, \"mappings\": &#123; \"shell\": &#123; \"properties\": &#123; \"command\": &#123; \"type\": \"text\", \"fields\": &#123; \"keyword\": &#123; \"type\": \"keyword\", \"ignore_above\": 256 &#125; &#125; &#125; &#125; &#125; &#125;, \"settings\": &#123; \"index\": &#123; \"creation_date\": \"1585796252661\", \"number_of_shards\": \"5\", \"number_of_replicas\": \"1\", \"uuid\": \"FrQU3tV4Smu5XioGH6qUjw\", \"version\": &#123; \"created\": \"6060199\" &#125;, \"provided_name\": \"history_demo\" &#125; &#125; &#125;&#125;## æŸ¥çœ‹æ‰€æœ‰çš„indices@method: GET@url: http://localhost:9200/_cat/indices@remark: ä½¿ç”¨`_cat/indices`@return:yellow open oss JYYZYHlxQsCYpUfJGjNnfw 5 1 0 0 1.2kb 1.2kbyellow open doc 0JUEuXarQ0aBaB1YHD2KcA 5 1 1 0 4.7kb 4.7kbyellow open history_demo FrQU3tV4Smu5XioGH6qUjw 5 1 1 0 4.4kb 4.4kbyellow open posts c18QVZ00Snyp1OOomxjJuA 5 1 1 0 5.5kb 5.5kbgreen open .kibana_1 jLWNf4ysRDSUvR3qfmv5Ow 1 0 2 0 9.3kb 9.3kbyellow open blog x_vNxVVHT6qgQY3_RKiaHg 5 1 6 0 28.3kb 28.3kbyellow open person 1ctpvuoqTV-vTO4q9G9cnQ 5 1 2 0 8.1kb 8.1kb æ’å…¥documents 123456789101112131415161718192021222324252627282930313233343536373839## æ’å…¥å•æ¡æ•°æ®@method: PUT/POST@url: http://localhost:9200/history_demo/shell/3@data: &#123;\"command\":\"df -h\"&#125;@return: &#123; \"_index\": \"history_demo\", \"_type\": \"shell\", \"_id\": \"3\", \"_version\": 1, \"result\": \"created\", \"_shards\": &#123; \"total\": 2, \"successful\": 1, \"failed\": 0 &#125;, \"_seq_no\": 0, \"_primary_term\": 1&#125;## æ’å…¥æŒ‡å®šIDçš„å¤šæ¡æ•°æ®@method: PUT/POST@url: http://localhost:9200/history_demo/shell/_bulk@data: &#123;\"index\":&#123;\"_id\":6&#125;&#125;&#123;\"command\":\"mysql\"&#125;&#123;\"index\":&#123;\"_id\":7&#125;&#125;&#123;\"command\":\"logatsh\"&#125;#!!æ³¨æ„ è¿™ä¸ªjson_dataæœ«å°¾è¦å¤šç•™ä¸€è¡Œ@return: ...## æ’å…¥ä¸æŒ‡å®šIDçš„å¤šæ¡æ•°æ®@method: PUT/POST@url: http://localhost:9200/history_demo/shell/_bulk@data:&#123;\"index\":&#123;&#125;&#125;&#123;\"command\":\"mysql\"&#125;&#123;\"index\":&#123;&#125;&#125;&#123;\"command\":\"logatsh\"&#125; æŸ¥è¯¢ 1234567891011## æŸ¥è¯¢æ‰€æœ‰çš„documents@method: GET@url: http://localhost:9200/history_demo/shell/_search@data: &#123;\"query\":&#123;\"match_all\":&#123;&#125;&#125;&#125;@return: ...## æŒ‰æ¡ä»¶æŸ¥è¯¢@method: GET@url: http://localhost:9200/history_demo/shell/_search@data: &#123;\"query\":&#123;\"match\":&#123;\"command\":\"mysql\"&#125;&#125;&#125;@return: ... åˆ é™¤ 12345678910## æŒ‡å®šIDè¿›è¡Œdelete@method: DELETE@url: http://localhost:9200/history_demo/shell/1@return: ...## æ ¹æ®æ¡ä»¶åˆ é™¤@method:POST@url: http://localhost:9200/history_demo/shell/_delete_by_query@data: &#123;\"query\":&#123;\"match\":&#123;\"command\":\"mysql\"&#125;&#125;&#125;@return: ... ä¿®æ”¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051## æŒ‡å®šIDè¿›è¡Œä¿®æ”¹@method:POST@url: http://localhost:9200/history_demo/shell/2/_update@data: &#123; \"script\": &#123; \"source\":\"ctx._source.command=params.command\", \"lang\": \"painless\", \"params\": &#123; \"command\":\"history\" &#125; &#125;&#125;@return: ...@remark: ctxæŒ‡å½“å‰äº‹åŠ¡, _sourceæŒ‡å½“å‰çš„document, langæŒ‡ä½¿ç”¨painlessè„šæœ¬è¯­è¨€æ¥ç¼–å†™script## ä»…å¢åŠ å­—æ®µè¿›è¡Œä¿®æ”¹@method: POST@url: http://localhost:9200/history_demo/shell/2/_update@data: &#123; \"script\": &#123; \"source\": \"ctx._source.bash_time='2020-02-02'\" &#125;&#125;@return: ...## ä»…åˆ é™¤å­—æ®µè¿›è¡Œä¿®æ”¹@method: POST@url: http://localhost:9200/history_demo/shell/2/_update@data: &#123; \"script\": &#123; \"source\": \"ctx._source.remove('bash_time')\" &#125;&#125;@return: ...## æ ¹æ®æ¡ä»¶è¿›è¡Œä¿®æ”¹@method: POST@url: http://localhost:9200/history_demo/shell/_update_by_query@data: &#123; \"query\": &#123; \"match\":&#123;\"command\":\"df -h\"&#125; &#125;, \"script\": &#123; \"source\": \"ctx._source.command=params.command\", \"lang\": \"painless\", \"params\": &#123; \"command\": \"tail data.log\" &#125; &#125;&#125;@return: ..","categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://yoursite.com/categories/Elasticsearch/"}],"tags":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://yoursite.com/tags/Elasticsearch/"}]},{"title":"flaskæ€è·¯æ•´ç†","slug":"flaskæ€è·¯æ•´ç†","date":"2020-03-27T10:13:06.000Z","updated":"2020-03-27T10:35:34.834Z","comments":true,"path":"2020/03/27/flaskæ€è·¯æ•´ç†/","link":"","permalink":"http://yoursite.com/2020/03/27/flask%E6%80%9D%E8%B7%AF%E6%95%B4%E7%90%86/","excerpt":"","text":"flaskæ€è·¯æ•´ç†ä¸€. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒpython3 -m venv venv. venv/bin/activate äºŒ. init.pyä¸»è¦å·¥ä½œï¼š åˆ›å»ºåº”ç”¨ æ·»åŠ é…ç½® åˆå§‹åŒ–åº”ç”¨ æ³¨å†Œè“å›¾ åˆ›å»ºåº”ç”¨: 123456import osfrom flask import Flaskdef create_app(test_config=None): ## instance_relative_config ä½¿ç”¨Trueçš„è¯å°±ä¼šä»instanceæ–‡ä»¶å¤¹ä½œä¸ºé…ç½®æ–‡ä»¶çš„è·¯å¾„ app = Flask(__name__, instance_relative_config=True) æ·»åŠ é…ç½® 12345678910111213##æ–¹å¼ä¸€:app.config.from_mapping( SECRET_KEY='dev' )##æ–¹å¼äºŒ:#silent æ–‡ä»¶ä¸å­˜åœ¨æ˜¯å¦é™é»˜æŠ¥é”™app.config.from_pyfile('config.py', silent=True)#éšæœºkeyçš„ç”Ÿæˆimport osimport binasciibinascii.hexlify(os.urandom(16)) åˆå§‹åŒ–åº”ç”¨ 123app.teardown_appcontext(db.close_db) ##åœ¨è¿”å›å“åº”åè¿›è¡Œæ¸…ç†è°ƒç”¨çš„ç¨‹åºapp.cli.add_command(db.init_db_command) ##æ·»åŠ å‘½ä»¤è¡ŒæŒ‡ä»¤ æ³¨å†Œè“å›¾ 12from . import authapp.register_buleprint(auth.bp) ä¸‰ã€db.py ä½¿ç”¨clickåˆ›å»ºå‘½ä»¤ 12345678import clickfrom flask.cli import with_appcontext@click.command('init-db')@with_appcontextdef init_db_command(): **** click.echo(\"è¾“å‡ºå†…å®¹\") æ•°æ®åº“è¿æ¥ä½¿ç”¨g,ä¸ä¼šæ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°åˆ›å»ºè¿æ¥ 1234567from flasj import current_app, gdef get_db(): if 'db' not in g: g.db = åˆ›å»ºè¿æ¥ return g.db å…³é—­æ•°æ®åº“ 12345def close_db(e=None): db = g.pop('db', None) if db is not None: db.close() å››ã€å…·ä½“é€»è¾‘ è“å›¾ 123from flask import Blueprintbp &#x3D; Blueprint(&#39;auth&#39;, __name__, url_prefix&#x3D;&#39;&#x2F;auth&#39;) å¯†ç ç›¸å…³ 1from werkzeug.security import check_password_hash, generate_password_hash ä¿è¯è¯·æ±‚ä¹‹å‰çŸ¥é“å½“æ—¶çš„ç”¨æˆ· 12345678@bp.before app_requestdef load_logged_in_user(): user_id = session.get('user_id') if user_id is None: g.user = None else: g.user = get_db()..... è¦æ±‚æ˜¯åœ¨ç™»å½•çŠ¶æ€(ä½¿ç”¨è£…é¥°ç¬¦) 123456789import functoolsdef login_required(view): @functools.wraps(view) def wrapped_view(**kwargs): if g.user is None: return redirect(url_for(\"auth.login\")) return view(**kwargs) return wrapped_view äº”ã€é¡¹ç›®å¯å®‰è£… setup.py 123456789101112from setuptools import find_packages, setupsetup( name='flaskr', version='1.0.0', packages=find_packages(), include_package_data=True, zip_safe=False, install_requires=[ 'flask', ],) MANIIFEST.in 1234include flaskr&#x2F;schema.sqlgraft flaskr&#x2F;staticgraft flaskr&#x2F;templatesglobal-exclude *.pyc å¯ä»¥ä½¿ç”¨pip install -e .å®‰è£…é¡¹ç›® å…­ã€éƒ¨ç½²äº§å“ æ„å»º 123pip install wheelpython setup.py bdist_wheel å®‰è£…å°†ç”Ÿæˆçš„.whlæ–‡ä»¶å‘é€åˆ°æœåŠ¡æ±‚ 1pip install ***.whl æ›´æ”¹é…ç½®æ˜¯åœ¨venv/var/***-instance/ä¸‹ ä¸ƒã€è¿è¡Œäº§å“æœåŠ¡å™¨12pip iinstall waitresswaitress-serve --call &#39;appname:create_app&#39; å¯åŠ¨åº”ç”¨ 12345export FLASK_APP&#x3D;APP_NAMEexport FLASK_ENV&#x3D;developmentflask runflask init-db","categories":[{"name":"python","slug":"python","permalink":"http://yoursite.com/categories/python/"}],"tags":[{"name":"flask","slug":"flask","permalink":"http://yoursite.com/tags/flask/"},{"name":"python","slug":"python","permalink":"http://yoursite.com/tags/python/"}]},{"title":"tmuxâ€”â€”åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹","slug":"tmuxâ€”â€”åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹","date":"2020-03-27T04:00:05.000Z","updated":"2020-03-27T04:09:32.564Z","comments":true,"path":"2020/03/27/tmuxâ€”â€”åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹/","link":"","permalink":"http://yoursite.com/2020/03/27/tmux%E2%80%94%E2%80%94%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/","excerpt":"","text":"tmuxâ€”â€”åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹ ä½¿ç”¨tmuxåå°è¿è¡Œbash_history_notifyé¡¹ç›® ä¸€ã€å®‰è£…tmux12345#mac:brew install tmux#centos:yum install tmux äºŒã€é…ç½®tmux ä½¿ç”¨äº†githubä¸Šçš„é…ç½®ï¼Œç„¶ååšäº†ä¿®æ”¹tmuxçš„é»˜è®¤å¿«æ·é”®å‰ç¼€ä¸º ctrl + b, ç°åœ¨æ”¹ä¸ºctrl+aï¼Œä¸‹æ–‡ä¸­ä½¿ç”¨Prefixä»£æ›¿ctrl+aâš ï¸ :ä½¿ç”¨å¿«æ·é”®æ˜¯å…ˆæ‘ä¸‹å¿«æ·é”®å‰ç¼€ï¼Œç„¶åæŠ¬æ‰‹ï¼Œåœ¨è¿›è¡Œå…·ä½“çš„å¿«æ·æŒ‰é”® 1234cdgit clone https:&#x2F;&#x2F;github.com&#x2F;gpakosz&#x2F;.tmux.gitln -s -f .tmux&#x2F;.tmux.confcp .tmux&#x2F;.tmux.conf.local . ä¿®æ”¹å¿«æ·é”®å‰ç¼€ vim .tmux/.tmux.conf.localå»æ‰290è¡Œé™„è¿‘çš„æ³¨é‡Šç¬¦ 1234unbind C-aunbind C-bset -g prefix C-abind C-a send-prefix ä¸‰ã€ä½¿ç”¨tmuxå¼€å¯ä»»åŠ¡ bcc_00åˆ›å»ºkafka_serverçš„sessionn1tmux new -s kafka_server ä½¿ç”¨Prefix+%åˆ†å±ï¼Œä½¿ç”¨Prefix+æ–¹å‘é”®åˆ‡æ¢é¼ æ ‡æ‰€åœ¨çª—æ ¼ åœ¨çª—æ ¼1ä¸­å¯åŠ¨zookeeper 12cd app&#x2F;kafka_2.12-2.4.0&#x2F;.&#x2F;bin&#x2F;zookeeper-server-start.sh .&#x2F;config&#x2F;zookeeper.properties åœ¨çª—æ ¼2ä¸­å¯åŠ¨kafka 12cd app&#x2F;kafka_2.12-2.4.0&#x2F;.&#x2F;bin&#x2F;kafka-server-start.sh .&#x2F;config&#x2F;server.properties ) ä½¿ç”¨Prefix+c åˆ›å»ºæ–°çª—å£,å¹¶åˆ›å»º3ä¸ªçª—æ ¼,å¯åŠ¨bash_historyçš„æ¶ˆè´¹ç«¯ã€ç”Ÿäº§ç«¯ã€å®éªŒçª—å£ åœ¨çª—æ ¼1ä¸­å¯åŠ¨æ¶ˆè´¹ç«¯ 12cd ~&#x2F;code&#x2F;python&#x2F;bash_history&#x2F;python bash_history_consumer.py åœ¨çª—æ ¼2ä¸­å¯åŠ¨ç”Ÿäº§ç«¯ 12cd ~&#x2F;code&#x2F;python&#x2F;bash_history&#x2F;python bash_history_producer.py ~&#x2F;.bash_history åœ¨çª—æ ¼3ä¸­éšä¾¿è¾“å…¥å‘½ä»¤ï¼Œæ£€æŸ¥å¦å¤–ä¸¤ä¸ªçª—æ ¼æ˜¯å¦æœ‰è¾“å‡º bcc_01ä¸Šå¼€å¯ç”Ÿäº§ç«¯åŒä¸Šæ­¥éª¤ï¼Œbcc_01ä¸Šæ²¡æœ‰æ¶ˆè´¹ç«¯ ä½¿ç”¨Prefix + d é€€å‡ºsession ä½¿ç”¨tmux ls æŸ¥çœ‹sessionï¼Œ ä½¿ç”¨tmux at -t &lt;session_name&gt;è¿æ¥session","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"http://yoursite.com/categories/%E5%B7%A5%E5%85%B7/"}],"tags":[]},{"title":"kafakç¤ºä¾‹-è¿œç¨‹ç›‘æ§ç»ˆç«¯è¾“å…¥","slug":"kafakç¤ºä¾‹-è¿œç¨‹ç›‘æ§ç»ˆç«¯è¾“å…¥","date":"2020-03-26T03:52:54.000Z","updated":"2020-03-26T03:52:54.112Z","comments":true,"path":"2020/03/26/kafakç¤ºä¾‹-è¿œç¨‹ç›‘æ§ç»ˆç«¯è¾“å…¥/","link":"","permalink":"http://yoursite.com/2020/03/26/kafak%E7%A4%BA%E4%BE%8B-%E8%BF%9C%E7%A8%8B%E7%9B%91%E6%8E%A7%E7%BB%88%E7%AB%AF%E8%BE%93%E5%85%A5/","excerpt":"","text":"kafakç¤ºä¾‹-è¿œç¨‹ç›‘æ§ç»ˆç«¯è¾“å…¥ ä½¿ç”¨pyinotifyç›‘å¬.bash_historyæ–‡ä»¶ï¼Œä½¿ç”¨kafkaç”Ÿäº§æ¶ˆè´¹ ä¸€ã€kafkaå®‰è£…é…ç½® å®‰è£…javaç¯å¢ƒ å®˜ç½‘ä¸‹è½½kafkaå®‰è£…åŒ… 1wget http:&#x2F;&#x2F;archive.apache.org&#x2F;dist&#x2F;kafka&#x2F;1.0.0&#x2F;kafka_2.12-1.0.0.tgz è§£å‹å‹ç¼©åŒ… é…ç½®/config/server.properties 1advertised.listeners&#x3D;PLAINTEXT:&#x2F;&#x2F;&#123;&#123;IP&#125;&#125;:9092 å¯åŠ¨kafka 12345##zookeeperå¯åŠ¨.&#x2F;bin&#x2F;zookeeper-server-start.sh .&#x2F;config&#x2F;zookeeper.properties ##serverå¯åŠ¨.&#x2F;bin&#x2F;kafka-server-start.sh .&#x2F;config&#x2F;server.properties åˆ›å»ºtopic 1.&#x2F;bin&#x2F;kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic &#123;&#123;topic_name&#125;&#125; äºŒã€å®‰è£…pythonä¾èµ–12345#kafka-pythonpip install kafka-python#pyinotifypip install pyinotify ä¸‰ã€æœåŠ¡å™¨ç«¯ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495# -*- coding: utf-8 -*-# @Description: ç›‘å¬æ–‡ä»¶å˜æ›´å‘kafkaå‘é€# @Author: kowhoy# @Last Modified by: kowhoy# @filename: bash_history_producer.pyimport pyinotifyimport timeimport osimport sysimport jsonfrom kafka import KafkaProducerimport datetimeimport socketbootstrap_servers = \"ip:9092\"topic = \"bash_history\"host_name = \"bcc_00\"host_ip = socket.gethostbyname(socket.getfqdn(socket.gethostname()))'''@name: [class]Monitor_file@date: 2020-03-26 09:41:13@desc: ç›‘å¬æ–‡ä»¶@param: [str]filename @return: '''class Monitor_file: def notify_bash_history(self, filename): wm = pyinotify.WatchManager() notifier = pyinotify.Notifier(wm) wm.watch_transient_file(filename, pyinotify.IN_MODIFY, Process_transient_file) notifier.loop()'''@name: [class]Process_transient_file@date: 2020-03-26 09:44:29@desc: æ–‡ä»¶å‘ç”Ÿå˜åŒ–è§¦å‘@param: @return: '''class Process_transient_file(pyinotify.ProcessEvent): def process_IN_MODIFY(self, event): line = file.readlines() if line: if len(line) == 2: order_time = int(line[0][1:-1]) order_time_array = time.localtime(order_time) order_time_str = time.strftime(\"%Y-%m-%d %H:%M:%S\", order_time_array) order = line[1][:-1] msg = &#123; \"host_name\": host_name, \"host_ip\": host_ip, \"order_time\": order_time_str, \"order\": order &#125; Send_to_kafka().send_msg(msg)'''@name: [class]Send_to_kafka@date: 2020-03-26 09:47:50@desc: å‘kafkaå‘é€msg@param:@return: '''class Send_to_kafka(): def __init__(self): self.producer = KafkaProducer(bootstrap_servers=bootstrap_servers) def send_msg(self, msg): msg = json.dumps(msg, ensure_ascii=False).encode(\"utf-8\") self.producer.send(topic, msg) print(\"-\"*10, \"æ•°æ®å·²å‘é€\", \"-\"*10) print(msg) self.producer.flush()if __name__ == \"__main__\": filename = sys.argv[1] if not os.path.exists(filename): raise FileExistsError file_stat = os.stat(filename) file_size = file_stat[6] file = open(filename, \"r\") file.seek(file_size) Monitor_file().notify_bash_history(filename) å››ã€å®¢æˆ·ç«¯ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697# -*- coding: utf-8 -*-# @Description: # @Author: kowhoy# @Date: 2020-03-26 10:15:24# @Last Modified time: 2020-03-26 11:25:15from kafka import KafkaConsumerfrom kafka.structs import TopicPartitionimport pandas as pdfrom sqlalchemy import create_engineimport jsonimport sysimport osdbh_config = &#123; \"host\": \"localhost\", \"user\": \"root\", \"passwd\": \"passwd\", \"database\": \"bash_history\", \"table\": \"bash_history_log\"&#125;save_to_tb = True ## æ˜¯å¦å­˜æ•°æ®åº“topic = \"bash_history\"bootstrap_servers = [\"ip:9092\"]single_file_size = 1 #Mclass Bash_history_consumer: def __init__(self): self.topic = \"bash_history\" self.consumer = KafkaConsumer(bootstrap_servers=bootstrap_servers) self.log_file_path = \"./bash_history_log/\" log_files = os.listdir(self.log_file_path) max_log_count = max([int(filename.split(\"_\")[-1]) for filename in log_files]) if len(log_files) &gt; 0 else -1 self.count = max_log_count + 1 self.save_list = [] if save_to_tb: e = \"mysql+pymysql://%s:%s@%s/%s\"%(dbh_config[\"user\"], dbh_config[\"passwd\"], dbh_config[\"host\"], dbh_config[\"database\"]) self.dbh = create_engine(e) empty_sql = 'select * from information_schema.TABLES where TABLE_SCHEMA = \"&#123;db&#125;\" and TABLE_NAME = \"&#123;tb&#125;\"'.\\ format(db=dbh_config[\"database\"], tb=dbh_config[\"table\"]) empty_df = pd.read_sql_query(empty_sql, self.dbh) self.tb_empty = empty_df.empty def bash_consumer(self): self.consumer.assign([TopicPartition(topic=topic, partition=0)]) for msg in self.consumer: msg_offset = msg.offset msg_value = (msg.value).decode(\"utf-8\") msg_value = json.loads(msg_value) self.save_list.append(msg_value) save_data_size = sys.getsizeof(self.save_list) if save_data_size &gt;= single_file_size * 1024 * 1024: save_file = self.log_file_path + \"bash_history_log_\" + str(self.count) self.count += 1 with open(save_file, \"w+\") as f: for line in self.save_list: f.write(line.decode(\"utf-8\")+\"\\n\") self.save_list = [] print(\"*\"*10, \"å†™å…¥æ–‡ä»¶\", \"*\"*10) if save_to_tb: if self.tb_empty: add_way = \"replace\" self.tb_empty = False else: add_way = \"append\" for k, v in msg_value.items(): msg_value[k] = [v] insert_df = pd.DataFrame.from_dict(msg_value) insert_df.to_sql(dbh_config[\"table\"], self.dbh, if_exists=add_way, index=False) print(\"å½“å‰size\", save_data_size, \"\\t\", msg_value)if __name__ == \"__main__\": Bash_history_consumer().bash_consumer() äº”ã€å¼€å¯ä»»åŠ¡ æˆ‘æ˜¯ä½¿ç”¨bcc_00ä½œä¸ºå”¯ä¸€çš„æ¶ˆè´¹è€…ï¼Œbcc_00å’Œbcc_01ä½œä¸ºä¸¤ä¸ªç”Ÿäº§è€…ï¼Œä¿®æ”¹å¥½ä»£ç ä¸­çš„é…ç½®æ•°æ® bcc_00å¼€å¯æ¶ˆè´¹è€… 1python bash_history_consumer.py bcc_00 å’Œ bcc_01åˆ†åˆ«å¼€å¯ç”Ÿäº§è€… 1python bash_history_producer.py ~&#x2F;.bash_history æ–°èµ·çª—å£è¿›è¡Œå‘½ä»¤è¡Œæ“ä½œï¼Œå°±å¯ä»¥åœ¨æ§åˆ¶å°å’Œæ•°æ®åº“çœ‹åˆ°ç›¸å…³bash 00_consumer: 00_producer: 01_producer: sql_table(ä¸¤å°bccå†…ç½‘ipä¸€æ ·):","categories":[{"name":"Python","slug":"Python","permalink":"http://yoursite.com/categories/Python/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"http://yoursite.com/tags/kafka/"},{"name":"pyinotify","slug":"pyinotify","permalink":"http://yoursite.com/tags/pyinotify/"}]},{"title":"macä¸‹chromedriverå‡çº§","slug":"macä¸‹chromedriverå‡çº§","date":"2020-03-13T02:50:14.000Z","updated":"2020-03-13T02:50:14.554Z","comments":true,"path":"2020/03/13/macä¸‹chromedriverå‡çº§/","link":"","permalink":"http://yoursite.com/2020/03/13/mac%E4%B8%8Bchromedriver%E5%8D%87%E7%BA%A7/","excerpt":"","text":"ä¸‹è½½ä¸æœ¬åœ°chromeç‰ˆæœ¬ä¸€è‡´çš„chromedriver,ä¸‹è½½åœ°å€[http://chromedriver.storage.googleapis.com/index.html] è§£å‹åˆ°æœ¬åœ°çš„ /usr/local/bin æ£€æŸ¥ç‰ˆæœ¬ chromedirver -v","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"http://yoursite.com/categories/%E5%B7%A5%E5%85%B7/"}],"tags":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"http://yoursite.com/tags/%E5%B7%A5%E5%85%B7/"}]},{"title":"scalaä¼´ç”Ÿç±»å’Œä¼´ç”Ÿå¯¹è±¡","slug":"scalaä¼´ç”Ÿç±»å’Œä¼´ç”Ÿå¯¹è±¡","date":"2020-02-23T11:36:55.000Z","updated":"2020-02-23T11:36:55.191Z","comments":true,"path":"2020/02/23/scalaä¼´ç”Ÿç±»å’Œä¼´ç”Ÿå¯¹è±¡/","link":"","permalink":"http://yoursite.com/2020/02/23/scala%E4%BC%B4%E7%94%9F%E7%B1%BB%E5%92%8C%E4%BC%B4%E7%94%9F%E5%AF%B9%E8%B1%A1/","excerpt":"","text":"Scalaä¼´ç”Ÿç±»å’Œä¼´ç”Ÿå¯¹è±¡ å®šä¹‰ï¼š åœ¨Scalaä¸­ï¼Œç±»åå’Œå¯¹è±¡åä¸€è‡´æ—¶ï¼Œäº’ä¸ºä¼´ç”Ÿç±»å’Œä¼´ç”Ÿå¯¹è±¡ã€‚ ä¾‹å­:123456789// ä¼´ç”Ÿç±»class ApplyTest &#123;&#125;// ä¼´ç”Ÿå¯¹è±¡object ApplyTest &#123;&#125; ä½¿ç”¨: é€šå¸¸åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­å†™apply()æ–¹æ³•ï¼Œç„¶ååœ¨applyæ–¹æ³•ä¸­å®ä¾‹ä¼´ç”Ÿç±»ï¼Œç„¶åæ¯æ¬¡ä½¿ç”¨ç±»åç§°()çš„æ—¶å€™ï¼Œå°±å·²ç»å®ä¾‹åŒ–äº†ç±» ä¾‹å­:12345678910111213141516object ApplyApp &#123; def main(args:Array[String]):Unit = &#123; val c = ApplyTest() println(c) &#125;&#125;class ApplyTest &#123;&#125;object ApplyTest &#123; def apply() = &#123; new ApplyTest() &#125;&#125;","categories":[{"name":"Scala","slug":"Scala","permalink":"http://yoursite.com/categories/Scala/"}],"tags":[{"name":"ä¼´ç”Ÿ","slug":"ä¼´ç”Ÿ","permalink":"http://yoursite.com/tags/%E4%BC%B4%E7%94%9F/"}]}]}